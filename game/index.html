<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Emi's Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        canvas {
            background-color: #1D2B53;
            background: radial-gradient(circle, #29ADFF 0%, #1D2B53 100%);
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.8.0/p5.min.js"></script>
    <script>
        const g = {};
        let health = 200;

        class rectangle {
            constructor(x, y, w, h, c) {
                this.x = x || 0;
                this.y = y || 0;
                this.w = w || 0;
                this.h = h || 0;
                this.c = c || "#ffffff";
                this.s = {};
            }

            collision(r2) {
                return (
                    this.x + this.w > r2.x &&
                    this.x < r2.x + r2.w &&
                    r2.y + r2.h > this.y &&
                    r2.y < this.y + this.h
                );
            }

            draw() {
                // stroke("#000000");
                // strokeWeight(3);
                // noStroke();
                stroke(this.c);
                strokeWeight(1);

                fill(this.c);
                rect(this.x, this.y, this.w, this.h);
            }

            center() {
                return {
                    x: this.x + (this.w * 0.5),
                    y: this.y + (this.h * 0.5)
                }
            }

            distance(other) {
                let cen = other.center();
                let ten = this.center();
                return Math.sqrt((ten.x - cen.x) ** 2 + (ten.y - cen.y) ** 2)
            }
        }

        let query = location.search == "" ? {} : JSON.parse(location.search.replace(/([a-zA-Z]+)=([a-zA-Z0-9=]+)&/g,
            '"$1":"$2",').replace(
            /([a-zA-Z\/]+)=([a-zA-Z0-9=\/]+)/g, '"$1":"$2"').replace("?", "{") + "}");
        let world;
        if (query.l !== undefined) {
            world = JSON.parse(atob(query.l));
        } else {
            world = {
                "backgroundcolor": "#00aaff",
                "height": 100,
                "infinite": true,
                "layers": [{
                    "draworder": "topdown",
                    "id": 2,
                    "name": "Object Layer 1",
                    "objects": [{
                            "height": 32,
                            "id": 3,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 6
                                },
                                {
                                    "name": "onTouch",
                                    "type": "string",
                                    "value": "location.reload()"
                                },
                                {
                                    "name": "onDraw",
                                    "type": "string",
                                    "value": "this.c='#00000000';"
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": true
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 3456,
                            "x": 0,
                            "y": 128
                        },
                        {
                            "height": 32,
                            "id": 6,
                            "name": "player",
                            "properties": [{
                                "name": "color",
                                "type": "int",
                                "value": 2
                            }],
                            "rotation": 0,
                            "type": "actor",
                            "visible": true,
                            "width": 32,
                            "x": 0,
                            "y": 0
                        },
                        {
                            "height": 416,
                            "id": 14,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 6
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": true
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 32,
                            "x": -32,
                            "y": -256
                        },
                        {
                            "height": 64,
                            "id": 15,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 3
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": true
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 32,
                            "x": 32,
                            "y": 64
                        },
                        {
                            "height": 96,
                            "id": 16,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 3
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": true
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 32,
                            "x": 0,
                            "y": 32
                        },
                        {
                            "height": 32,
                            "id": 17,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 3
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": true
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 192,
                            "x": 736,
                            "y": 96
                        },
                        {
                            "height": 96,
                            "id": 18,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 3
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": true
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 32,
                            "x": 128,
                            "y": 32
                        },
                        {
                            "height": 128,
                            "id": 19,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 3
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": true
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 32,
                            "x": 96,
                            "y": 0
                        },
                        {
                            "height": 64,
                            "id": 20,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 3
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": true
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 32,
                            "x": 160,
                            "y": 64
                        },
                        {
                            "height": 64,
                            "id": 21,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 3
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": true
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 32,
                            "x": 384,
                            "y": 64
                        },
                        {
                            "height": 96,
                            "id": 22,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 3
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": true
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 32,
                            "x": 352,
                            "y": 32
                        },
                        {
                            "height": 32,
                            "id": 23,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 3
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": true
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 32,
                            "x": 416,
                            "y": 96
                        },
                        {
                            "height": 128,
                            "id": 24,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 3
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": true
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 32,
                            "x": 544,
                            "y": 0
                        },
                        {
                            "height": 96,
                            "id": 25,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 3
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": true
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 32,
                            "x": 512,
                            "y": 32
                        },
                        {
                            "height": 192,
                            "id": 26,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 3
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": true
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 32,
                            "x": 640,
                            "y": -64
                        },
                        {
                            "height": 160,
                            "id": 27,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 3
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": true
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 64,
                            "x": 672,
                            "y": -32
                        },
                        {
                            "height": 32,
                            "id": 28,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 3
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": true
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 160,
                            "x": 192,
                            "y": 96
                        },
                        {
                            "height": 32,
                            "id": 29,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 3
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": true
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 128,
                            "x": 800,
                            "y": -32
                        },
                        {
                            "height": 128,
                            "id": 30,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 3
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": true
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 32,
                            "x": 992,
                            "y": 0
                        },
                        {
                            "height": 96,
                            "id": 31,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 3
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": true
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 32,
                            "x": 960,
                            "y": 32
                        },
                        {
                            "height": 16,
                            "id": 33,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 9
                                },
                                {
                                    "name": "onTouch",
                                    "type": "string",
                                    "value": "if(walls.indexOf(this)!==-1){walls.splice(walls.indexOf(this),1);g.coins=(g.coins||0)+1;};"
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": false
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 16,
                            "x": 264,
                            "y": 8
                        },
                        {
                            "height": 16,
                            "id": 35,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 5
                                },
                                {
                                    "name": "onTouch",
                                    "type": "string",
                                    "value": "health--==0?location.reload():0;"
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": true
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 64,
                            "x": 224,
                            "y": 80
                        },
                        {
                            "height": 16,
                            "id": 36,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 9
                                },
                                {
                                    "name": "onTouch",
                                    "type": "string",
                                    "value": "if(walls.indexOf(this)!==-1){walls.splice(walls.indexOf(this),1);g.coins=(g.coins||0)+1;};"
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": false
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 16,
                            "x": 104,
                            "y": -24
                        },
                        {
                            "height": 16,
                            "id": 37,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 9
                                },
                                {
                                    "name": "onTouch",
                                    "type": "string",
                                    "value": "if(walls.indexOf(this)!==-1){walls.splice(walls.indexOf(this),1);g.coins=(g.coins||0)+1;};"
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": false
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 16,
                            "x": 232,
                            "y": 8
                        },
                        {
                            "height": 16,
                            "id": 38,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 9
                                },
                                {
                                    "name": "onDraw",
                                    "type": "string",
                                    "value": "this.w = g.coins \/ 200 * width;\nthis.x = +camera.center().x - width\/2;\nthis.y = +camera.center().y - height\/2+16;"
                                },
                                {
                                    "name": "onTouch",
                                    "type": "string",
                                    "value": "if(walls.indexOf(this)!==-1){walls.splice(walls.indexOf(this),1);g.coins=(g.coins||0)+1;};"
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": false
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 0,
                            "x": -32,
                            "y": -352
                        },
                        {
                            "height": 16,
                            "id": 39,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 9
                                },
                                {
                                    "name": "onTouch",
                                    "type": "string",
                                    "value": "if(walls.indexOf(this)!==-1){walls.splice(walls.indexOf(this),1);g.coins=(g.coins||0)+1;};"
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": false
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 16,
                            "x": 328,
                            "y": 40
                        },
                        {
                            "height": 16,
                            "id": 40,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 5
                                },
                                {
                                    "name": "onTouch",
                                    "type": "string",
                                    "value": "health--==0?location.reload():0;"
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": true
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 32,
                            "x": 416,
                            "y": 80
                        },
                        {
                            "height": 16,
                            "id": 41,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 9
                                },
                                {
                                    "name": "onTouch",
                                    "type": "string",
                                    "value": "if(walls.indexOf(this)!==-1){walls.splice(walls.indexOf(this),1);g.coins=(g.coins||0)+1;};"
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": false
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 16,
                            "x": 552,
                            "y": -88
                        },
                        {
                            "height": 16,
                            "id": 42,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 9
                                },
                                {
                                    "name": "onTouch",
                                    "type": "string",
                                    "value": "if(walls.indexOf(this)!==-1){walls.splice(walls.indexOf(this),1);g.coins=(g.coins||0)+1;};"
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": false
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 16,
                            "x": 520,
                            "y": -88
                        },
                        {
                            "height": 16,
                            "id": 43,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 9
                                },
                                {
                                    "name": "onTouch",
                                    "type": "string",
                                    "value": "if(walls.indexOf(this)!==-1){walls.splice(walls.indexOf(this),1);g.coins=(g.coins||0)+1;};"
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": false
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 16,
                            "x": 648,
                            "y": -120
                        },
                        {
                            "height": 16,
                            "id": 44,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 9
                                },
                                {
                                    "name": "onTouch",
                                    "type": "string",
                                    "value": "if(walls.indexOf(this)!==-1){walls.splice(walls.indexOf(this),1);g.coins=(g.coins||0)+1;};"
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": false
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 16,
                            "x": 840,
                            "y": -88
                        },
                        {
                            "height": 16,
                            "id": 45,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 9
                                },
                                {
                                    "name": "onTouch",
                                    "type": "string",
                                    "value": "if(walls.indexOf(this)!==-1){walls.splice(walls.indexOf(this),1);g.coins=(g.coins||0)+1;};"
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": false
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 16,
                            "x": 872,
                            "y": 40
                        },
                        {
                            "height": 16,
                            "id": 46,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 9
                                },
                                {
                                    "name": "onTouch",
                                    "type": "string",
                                    "value": "if(walls.indexOf(this)!==-1){walls.splice(walls.indexOf(this),1);g.coins=(g.coins||0)+1;};"
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": false
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 16,
                            "x": 840,
                            "y": 40
                        },
                        {
                            "height": 16,
                            "id": 47,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 5
                                },
                                {
                                    "name": "onTouch",
                                    "type": "string",
                                    "value": "health--==0?location.reload():0;"
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": true
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 64,
                            "x": 832,
                            "y": 80
                        },
                        {
                            "height": 16,
                            "id": 48,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 9
                                },
                                {
                                    "name": "onTouch",
                                    "type": "string",
                                    "value": "if(walls.indexOf(this)!==-1){walls.splice(walls.indexOf(this),1);g.coins=(g.coins||0)+1;};"
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": false
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 16,
                            "x": 968,
                            "y": 8
                        },
                        {
                            "height": 32,
                            "id": 49,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 3
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": true
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 288,
                            "x": 1120,
                            "y": 96
                        },
                        {
                            "height": 160,
                            "id": 50,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 3
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": true
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 64,
                            "x": 1344,
                            "y": -64
                        },
                        {
                            "height": 96,
                            "id": 51,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 3
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": true
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 64,
                            "x": 1280,
                            "y": 0
                        },
                        {
                            "height": 32,
                            "id": 52,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 3
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": true
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 64,
                            "x": 1216,
                            "y": 64
                        },
                        {
                            "height": 16,
                            "id": 53,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 9
                                },
                                {
                                    "name": "onTouch",
                                    "type": "string",
                                    "value": "if(walls.indexOf(this)!==-1){walls.splice(walls.indexOf(this),1);g.coins=(g.coins||0)+1;};"
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": false
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 16,
                            "x": 1192,
                            "y": 40
                        },
                        {
                            "height": 16,
                            "id": 54,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 9
                                },
                                {
                                    "name": "onTouch",
                                    "type": "string",
                                    "value": "if(walls.indexOf(this)!==-1){walls.splice(walls.indexOf(this),1);g.coins=(g.coins||0)+1;};"
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": false
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 16,
                            "x": 1160,
                            "y": 40
                        },
                        {
                            "height": 16,
                            "id": 55,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 9
                                },
                                {
                                    "name": "onTouch",
                                    "type": "string",
                                    "value": "if(walls.indexOf(this)!==-1){walls.splice(walls.indexOf(this),1);g.coins=(g.coins||0)+1;};"
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": false
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 16,
                            "x": 1384,
                            "y": -120
                        },
                        {
                            "height": 16,
                            "id": 56,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 9
                                },
                                {
                                    "name": "onTouch",
                                    "type": "string",
                                    "value": "if(walls.indexOf(this)!==-1){walls.splice(walls.indexOf(this),1);g.coins=(g.coins||0)+1;};"
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": false
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 16,
                            "x": 1352,
                            "y": -120
                        },
                        {
                            "height": 32,
                            "id": 57,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 3
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": true
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 192,
                            "x": 1472,
                            "y": 0
                        },
                        {
                            "height": 16,
                            "id": 58,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 9
                                },
                                {
                                    "name": "onTouch",
                                    "type": "string",
                                    "value": "if(walls.indexOf(this)!==-1){walls.splice(walls.indexOf(this),1);g.coins=(g.coins||0)+1;};"
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": false
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 16,
                            "x": 1576,
                            "y": -88
                        },
                        {
                            "height": 16,
                            "id": 59,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 9
                                },
                                {
                                    "name": "onTouch",
                                    "type": "string",
                                    "value": "if(walls.indexOf(this)!==-1){walls.splice(walls.indexOf(this),1);g.coins=(g.coins||0)+1;};"
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": false
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 16,
                            "x": 1544,
                            "y": -88
                        },
                        {
                            "height": 16,
                            "id": 60,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 5
                                },
                                {
                                    "name": "onTouch",
                                    "type": "string",
                                    "value": "health--==0?location.reload():0;"
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": true
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 64,
                            "x": 1504,
                            "y": -16
                        },
                        {
                            "height": 32,
                            "id": 61,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 3
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": true
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 352,
                            "x": 1696,
                            "y": 96
                        },
                        {
                            "height": 32,
                            "id": 62,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 3
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": true
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 160,
                            "x": 1760,
                            "y": 64
                        },
                        {
                            "height": 16,
                            "id": 63,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 9
                                },
                                {
                                    "name": "onTouch",
                                    "type": "string",
                                    "value": "if(walls.indexOf(this)!==-1){walls.splice(walls.indexOf(this),1);g.coins=(g.coins||0)+1;};"
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": false
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 16,
                            "x": 1800,
                            "y": 40
                        },
                        {
                            "height": 16,
                            "id": 64,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 9
                                },
                                {
                                    "name": "onTouch",
                                    "type": "string",
                                    "value": "if(walls.indexOf(this)!==-1){walls.splice(walls.indexOf(this),1);g.coins=(g.coins||0)+1;};"
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": false
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 16,
                            "x": 1832,
                            "y": 40
                        },
                        {
                            "height": 16,
                            "id": 65,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 9
                                },
                                {
                                    "name": "onTouch",
                                    "type": "string",
                                    "value": "if(walls.indexOf(this)!==-1){walls.splice(walls.indexOf(this),1);g.coins=(g.coins||0)+1;};"
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": false
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 16,
                            "x": 1864,
                            "y": 40
                        },
                        {
                            "height": 16,
                            "id": 66,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 9
                                },
                                {
                                    "name": "onTouch",
                                    "type": "string",
                                    "value": "if(walls.indexOf(this)!==-1){walls.splice(walls.indexOf(this),1);g.coins=(g.coins||0)+1;};"
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": false
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 16,
                            "x": 2024,
                            "y": 72
                        },
                        {
                            "height": 16,
                            "id": 67,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 9
                                },
                                {
                                    "name": "onTouch",
                                    "type": "string",
                                    "value": "if(walls.indexOf(this)!==-1){walls.splice(walls.indexOf(this),1);g.coins=(g.coins||0)+1;};"
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": false
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 16,
                            "x": 1992,
                            "y": 72
                        },
                        {
                            "height": 16,
                            "id": 68,
                            "name": "",
                            "properties": [{
                                    "name": "color",
                                    "type": "int",
                                    "value": 5
                                },
                                {
                                    "name": "onTouch",
                                    "type": "string",
                                    "value": "health--==0?location.reload():0;"
                                },
                                {
                                    "name": "opaque",
                                    "type": "bool",
                                    "value": true
                                }
                            ],
                            "rotation": 0,
                            "type": "wall",
                            "visible": true,
                            "width": 32,
                            "x": 1920,
                            "y": 80
                        }
                    ],
                    "opacity": 1,
                    "type": "objectgroup",
                    "visible": true,
                    "x": 0,
                    "y": 0
                }],
                "nextlayerid": 3,
                "nextobjectid": 69,
                "orientation": "orthogonal",
                "renderorder": "right-down",
                "tiledversion": "1.2.3",
                "tileheight": 32,
                "tilesets": [],
                "tilewidth": 32,
                "type": "map",
                "version": 1.2,
                "width": 100
            };

        }
        let placeFree = function (xNew, yNew, wNew, hNew) {
            let temp = new rectangle(xNew, yNew, wNew || player.w, hNew || player.h);

            let cond = true;
            for (let i of walls) {
                cond = cond && (!i.collision(temp) || !i.s.props.opaque);
            }
            return cond;
        };

        let getCollisions = function (xNew, yNew, wNew, hNew) {
            let temp = new rectangle(xNew, yNew, wNew, hNew);
            let out = [];
            for (let i of walls) {
                if (i.collision(temp)) out.push(i);
            }
            return out;
        };

        const colors = [
                "#000000", //0
                "#1D2B53", //1
                "#7E2553", //2
                "#008751", //3
                "#AB5236", //4
                "#5F574F", //5
                "#C2C3C7", //6
                "#FFF1E8", //7
                "#FF004D", //8
                "#FFA300", //9
                "#FFEC27", //10
                "#00E436", //11
                "#29ADFF", //12
                "#83769C", //13
                "#FF77A8", //14
                "#FFCCAA" //15
            ],
            spd = 7 / 2,
            spdChk = 1 / 2,
            jumpHeight = 9,
            gravityDown = 1 / 2,
            jumpDown = 1 / 2;

        let gravity = 0,
            jumpSpeed = 0;

        // let world = {
        //     playerPos: [32, 32],
        //     world: [
        //         [0, 0, 32, 32 * 8],
        //         [32 * 7, 0, 32, 32 * 8],
        //         [32, 32 * 7, 32 * 6, 32]
        //     ]
        // };


        let objects = world.layers[0].objects;

        let playerObj = objects.filter(x => x.name == "player")[0]

        let player = new rectangle(
            playerObj.x,
            playerObj.y,
            playerObj.width,
            playerObj.height,
            colors[playerObj.properties.filter(x => x.name == "color")[0].value]
        );

        let walls = objects.filter(x => x.type == "wall").map(x => {
            let a;
            if (x.properties.filter(x => x.name == "color").length == 0) {
                a = new rectangle(x.x, x.y, x.width, x.height, colors[1]);
            } else {
                a = new rectangle(x.x, x.y, x.width, x.height, colors[x.properties.filter(x => x.name ==
                    "color")[0].value]);
            }

            a.s["onTouch"] = new Function(x.properties.filter(x => x.name == "onTouch")[0] ? x.properties
                .filter(x => x.name == "onTouch")[0].value : "");
            a.s["onDraw"] = new Function(x.properties.filter(x => x.name == "onDraw")[0] ? x.properties
                .filter(x => x.name == "onDraw")[0].value : "");
            a.s.props = {};
            x.properties.forEach((x2) => {
                a.s.props[x2.name] = x2.value;
            });
            return a;
        });

        function tween(v1, v2, tw) {
            return (v1 * (1 - tw)) + (v2 * (tw));
        }

        function setup() {
            createCanvas(innerWidth, innerHeight);
        }

        let camera = new rectangle(0, 0, 0, 0, "#00000000"),
            healthBar = new rectangle(0, 0, 0, 16, "#FF0000");

        function draw() {
            translate(
                -camera.center().x + width / 2,
                -camera.center().y + height / 2
            );
            clear();
            // background(colors[12]);
            movePlayer();
            let col = getCollisions(player.x - 1, player.y - 1, player.w + 2, player.h + 2);
            for (let i of col) {
                i.s.onTouch.call(i);
            }
            walls.forEach(x => x.s.onDraw.call(x));

            healthBar.w = health / 200 * width;
            healthBar.x = +camera.center().x - width / 2;
            healthBar.y = +camera.center().y - height / 2;
            if (camera.distance(player) > 64) {
                camera.x = tween(camera.x, player.x, 0.05);
                camera.y = tween(camera.y, player.y, 0.05);
            }

            walls.forEach(x => x.draw());
            player.draw();
            healthBar.draw();
        }

        let up = 0;
        let down = 0;
        let left = 0;
        let right = 0;

        function keyPressed() {
            if (keyCode === UP_ARROW) {
                up = 1;
            }
            if (keyCode === DOWN_ARROW) {
                down = 1;
            }
            if (keyCode === LEFT_ARROW) {
                left = 1;
            }
            if (keyCode === RIGHT_ARROW) {
                right = 1;
            }
        }

        function keyReleased() {
            if (keyCode === UP_ARROW) {
                up = 0;
            }
            if (keyCode === DOWN_ARROW) {
                down = 0;
            }
            if (keyCode === LEFT_ARROW) {
                left = 0;
            }
            if (keyCode === RIGHT_ARROW) {
                right = 0;
            }
        }

        function movePlayer() {
            let dir = right - left;

            for (let s = spd; s > 0; s -= spdChk) {
                if (placeFree(player.x + s * dir, player.y)) {
                    player.x += s * dir;
                    s = 0; // better than break
                }
            }

            if (up && !placeFree(player.x, player.y + 1)) {
                jumpSpeed = jumpHeight;
            }

            if (jumpSpeed > 0) {
                playerJump();
            } else {
                playerFall();
            }
        }

        function playerFall() {
            for (var i = gravity; i > 0; i -= gravityDown) {
                if (placeFree(player.x, player.y + i)) {
                    player.y += i;
                    break;
                }
            }

            if (placeFree(player.x, player.y + 1)) {
                gravity += gravityDown;
            } else {
                gravity = 0;
            }
        }

        function playerJump() {
            if (!placeFree(player.x, player.y - 1)) {
                jumpSpeed = 0;
            }

            for (var i = jumpSpeed; i > 0; i -= jumpDown) {
                if (placeFree(player.x, player.y - i)) {
                    player.y -= i;
                    i = 0;
                }
            }

            jumpSpeed -= jumpDown;
        }
    </script>
</head>

<body></body>

</html>
